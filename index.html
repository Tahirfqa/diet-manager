<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>الحمية الغذائية - أبو معتصم الغالي</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0077b6" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f4f6f9;
      color: #333;
      margin: 0;
      padding: 0;
    }
    /* Loader */
    #loader {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: #f4f6f9;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 9999;
    }
    #loader img {
      width: 120px; height: 120px;
    }
    #loaderText {
      margin-top: 10px;
      color: #777;
      font-size: 16px;
    }
    header {
      background-color: #0077b6;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 22px;
    }
    .hero {
      text-align: center;
      margin-top: 10px;
    }
    .hero img {
      width: 100%;
      max-width: 600px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .wisdom {
      font-style: italic;
      color: #555;
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    select, button {
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #0077b6;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #005f87;
    }
    .meal-output {
      margin-top: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      border: 1px solid #ddd;
    }
    .meal-output div {
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px dashed #ccc;
      line-height: 1.7;
    }
    .meal-output div:last-child {
      border-bottom: none;
    }
    footer {
      text-align: center;
      font-size: 14px;
      color: #888;
      margin: 30px 0 10px;
    }
    @media (max-width: 600px) {
      body { font-size: 17px; }
    }
  </style>
</head>
<body>

  <!-- Loader -->
  <div id="loader">
    <img src="icon-192.png" alt="Logo" />
    <div id="loaderText">جاري التحميل...</div>
  </div>

  <header>الحمية الغذائية - أبو معتصم الغالي</header>

  <!-- Hero Image -->
  <div class="hero">
    <img src="pic1.png" alt="صورة رئيسية لخطّة الحمية">
  </div>

  <div class="container">
    <div class="wisdom" id="wisdomText"></div>

    <label for="day">اختر اليوم:</label>
    <select id="day"></select>

    <label for="meal">اختر نوع الوجبة (أو اتركه لعرض جميع الوجبات):</label>
    <select id="meal">
      <option value="">كل الوجبات</option>
      <option value="فطور">فطور</option>
      <option value="وجبة خفيفة 1">وجبة خفيفة 1</option>
      <option value="غداء">غداء</option>
      <option value="وجبة خفيفة 2">وجبة خفيفة 2</option>
      <option value="عشاء">عشاء</option>
    </select>

    <button id="viewBtn" onclick="showMeal()">عرض</button>
    <button onclick="resetPage()">إعادة تعيين</button>

    <div id="mealResult" class="meal-output"></div>
  </div>

  <footer>تم إعداد هذا البرنامج بكل حب لأبو معتصم ❤️</footer>

  <script>
    const sheetURL = 'https://docs.google.com/spreadsheets/d/14gQEIbO44LevNhvrWV1tn8bYjvwyhG63hTSatC8WTw8/gviz/tq?tqx=out:json';
    let meals = {};
    const daysOfWeek = ['الأحد','الاثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت'];
    const wisdoms = [
      "الصحة تاج على رؤوس الأصحاء لا يراه إلا المرضى.",
      "ابدأ يومك بأكل صحي، واحصد يومًا مليئًا بالطاقة.",
      "العقل السليم في الجسم السليم، والغذاء المتوازن هو مفتاح كليهما.",
      "الوقاية خير من العلاج، والغذاء الصحي أول خطوات الوقاية.",
      "من يتحكم في طعامه، يتحكم في صحته وسعادته.",
      "جسمك هو بيتك الحقيقي، فحافظ عليه كما تحافظ على أغلى ممتلكاتك."
    ];
    const loadStart = Date.now();

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("wisdomText").textContent =
        wisdoms[Math.floor(Math.random() * wisdoms.length)];

      const daySelect = document.getElementById("day");
      daysOfWeek.forEach(day => {
        const opt = document.createElement("option");
        opt.value = day;
        opt.textContent = day;
        daySelect.appendChild(opt);
      });
      daySelect.value = daysOfWeek[new Date().getDay()];

      fetch(sheetURL)
        .then(res => res.text())
        .then(text => {
          const json = JSON.parse(text.substr(47).slice(0, -2));
          json.table.rows.forEach(row => {
            const d = row.c[0]?.v;
            if (!d) return;
            meals[d] = {
              'فطور': row.c[1]?.v || '',
              'وجبة خفيفة 1': row.c[2]?.v || '',
              'غداء': row.c[3]?.v || '',
              'وجبة خفيفة 2': row.c[4]?.v || '',
              'عشاء': row.c[5]?.v || ''
            };
          });
          showMealContent();
          const elapsed = Date.now() - loadStart;
          const delay = Math.max(0, 1200 - elapsed);
          setTimeout(() => document.getElementById('loader').style.display = 'none', delay);
        });
    });

    // الأصلي: عرض النتائج بدون تحميل صناعي
    function showMealContent() {
      const day = document.getElementById('day').value;
      const meal = document.getElementById('meal').value;
      const resultDiv = document.getElementById('mealResult');
      resultDiv.innerHTML = '';
      if (!meals[day]) {
        resultDiv.textContent = "لا توجد بيانات لهذا اليوم.";
        return;
      }
      const times = {
        'فطور': 'الساعة 10:30-9:30',
        'وجبة خفيفة 1': 'الساعة 12',
        'غداء': 'الساعة 2-3',
        'وجبة خفيفة 2': 'الساعة 5',
        'عشاء': 'الساعة 7-8'
      };
      const styleTime = t => `<div style="color:#777;font-size:14px;margin-bottom:10px;">${t}</div>`;
      if (meal) {
        const desc = meals[day][meal] || 'لا توجد بيانات لهذه الوجبة.';
        resultDiv.innerHTML = `
          <div>
            <strong>${meal}</strong><br>
            ${styleTime(times[meal] || '')}
            <div>${desc.replace(/\n/g, "<br>")}</div>
          </div>`;
      } else {
        let html = '';
        for (let mType in meals[day]) {
          html += `
            <div>
              <strong>${mType}</strong><br>
              ${styleTime(times[mType] || '')}
              <div>${meals[day][mType].replace(/\n/g, "<br>")}</div>
            </div>`;
        }
        resultDiv.innerHTML = html;
      }
    }

    // جديد: تأخير عرض النتائج لثانية مع تغيير زر العرض
    function showMeal() {
      const btn = document.getElementById('viewBtn');
      btn.disabled = true;
      btn.textContent = 'جاري التحميل...';
      setTimeout(() => {
        showMealContent();
        btn.disabled = false;
        btn.textContent = 'عرض';
      }, 1000);
    }

    function resetPage() {
      window.location.reload();
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => { reg.update(); })
          .catch(err => console.log('SW registration failed', err));
      });
    }
  </script>
</body>
</html>
